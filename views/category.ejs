<%- include('partials/header',{
  title: categoryName,
  name,
  showGetStarted:false
}) %>

<h1><%= categoryName %></h1>
<p style="color:var(--muted);max-width:600px"><%= categoryDesc %></p>

<% category.items.forEach((ep,i)=>{ %>

<div class="card" style="margin-top:16px">

  <div class="endpoint-head" onclick="toggle(<%= i %>)">
    <span class="method <%= ep.method.toLowerCase() %>">
      <%= ep.method %>
    </span>
    <span style="flex:1"><%= ep.path %></span>
    <span id="ic-<%= i %>">⌄</span>
  </div>

  <div class="endpoint-body" id="ep-<%= i %>">

    <% if(ep.alias){ %>
      <p style="color:var(--muted)"><%= ep.alias %></p>
    <% } %>

    <form onsubmit="exec(event,<%= i %>,'<%= ep.path %>','<%= ep.method %>')">

      <% if(ep.params){ %>
        <% Object.entries(ep.params).forEach(([k,v])=>{ %>
          <label style="font-size:13px;color:var(--muted)">
            <%= k %>
          </label>
          <input
            name="<%= k %>"
            placeholder="<%= v.example || '' %>"
            title="<%= v.desc || '' %>"
          />
        <% }) %>
      <% } %>

      <button class="exec">Execute</button>
    </form>

    <pre id="res-<%= i %>">Response will appear here…</pre>
  </div>
</div>

<% }) %>

<script>
function toggle(i){
  const el=document.getElementById('ep-'+i)
  el.classList.toggle('open')
  document.getElementById('ic-'+i).textContent=
    el.classList.contains('open')?'⌃':'⌄'
}

async function exec(e,i,path,method){
  e.preventDefault()
  const data=Object.fromEntries(new FormData(e.target))
  const out=document.getElementById('res-'+i)

  let res
  if(method==='GET'){
    const url=new URL(path,location.origin)
    Object.entries(data).forEach(([k,v])=>url.searchParams.append(k,v))
    res=await fetch(url)
  }else{
    res=await fetch(path,{
      method,
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify(data)
    })
  }

  out.textContent=JSON.stringify(await res.json(),null,2)
}
</script>

<%- include('partials/footer',{name}) %>