<%- include('partials/header', {
  title: `${categoryName} - ${name}`,
  description: categoryDesc
}) %>

<div class="mb-6">
  <a href="/" class="text-xs text-slate-500">← Back</a>

  <h2 class="text-2xl font-bold mt-2"><%= categoryName %></h2>
  <p class="text-xs text-slate-500">
    <%= categoryDesc %> • <%= category.items.length %> endpoints
  </p>
</div>

<div class="space-y-3">
  <% category.items.forEach((endpoint, i) => { %>
    <div class="border rounded-xl p-4">
      <button onclick="toggleEndpoint(<%= i %>)"
        class="w-full flex justify-between items-center text-left">

        <div>
          <span class="text-xs font-bold mr-2"><%= endpoint.method %></span>
          <span class="font-mono text-sm"><%= endpoint.path %></span>
          <div class="text-xs text-slate-500"><%= endpoint.alias %></div>
        </div>

        <span id="endpoint-icon-<%= i %>" class="material-icons-outlined">
          expand_more
        </span>
      </button>

      <div id="endpoint-<%= i %>" class="hidden mt-3">
        <form
          onsubmit="executeRequest(event,<%= i %>,'<%= endpoint.method %>','<%= endpoint.path %>','application/json')">
          <button class="gbtn text-xs mt-2">Execute</button>
        </form>

        <div id="response-<%= i %>"
             class="hidden mt-3 text-xs bg-slate-900 text-white p-3 rounded"></div>
      </div>
    </div>
  <% }) %>
</div>

<script>
  function toggleEndpoint(i){
    const el = document.getElementById(`endpoint-${i}`);
    const ic = document.getElementById(`endpoint-icon-${i}`);
    el.classList.toggle('hidden');
    ic.textContent = el.classList.contains('hidden')
      ? 'expand_more'
      : 'expand_less';
  }
</script>

<%- include('partials/footer', { name }) %>